<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>微信公众平台开发笔记 | 指尖魔法屋</title>

    
    <meta name="description" content="">
    <meta name="keywords" content="微信开发">

    
    <meta property="og:title" content="微信公众平台开发笔记">
    <meta property="og:description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://example.org/post/20_%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/">
    

    
    <link rel="icon" href="https://example.org/favicon.ico">

    
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/github-markdown.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
    
    
    <nav class="top-menu">
        <div class="container">
            <div class="left">
                <a href="https://example.org/">指尖魔法屋</a>
            </div>
            <ul class="menu">
                <li class="">
                    <a href="https://example.org/">首页</a>
                </li>
                <li class="">
                    <a href="https://example.org/categories/">分类</a>
                </li>
                <li class="">
                    <a href="https://example.org/tags/">标签</a>
                </li>
            </ul>
            <div class="right">
                <a href="/admin" class="admin-link">
                    <span>登录</span>
                </a>
            </div>
        </div>
    </nav>
    

    
    <main>
        
<div class="article-content">
    <div class="markdown-body">
        <ol>
<li>URL跳转,</li>
</ol>
<p>链接跳转</p>
<p><code>https://open.weixin.qq.com/connect/oauth2/authorize?appid=&quot;.$this-&gt;appid.&quot;&amp;redirect_uri=&quot;.urlencode(&quot;http://192.168.43.46/auit/index.php?c=app&amp;m=oauth&quot;).&quot;&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect</code></p>
<ol>
<li>用户进入页面,拿code换取ACCESS_TOKEN, 请求代码</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;https://api.weixin.qq.com/sns/oauth2/access_token?appid=&#34;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">appid</span><span class="o">.</span><span class="s2">&#34;&amp;secret=&#34;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span><span class="o">.</span><span class="s2">&#34;&amp;code=&#34;</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;&amp;grant_type=authorization_code&#34;</span><span class="p">);</span>
</span></span></code></pre></div><ol start="2">
<li>用ACCESS_TOKEN换取用户数据,请求代码</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;https://api.weixin.qq.com/sns/userinfo?access_token=&#34;</span><span class="o">.</span><span class="nv">$data</span><span class="o">-&gt;</span><span class="na">access_token</span><span class="o">.</span><span class="s2">&#34;&amp;openid=&#34;</span><span class="o">.</span><span class="nv">$data</span><span class="o">-&gt;</span><span class="na">openid</span><span class="o">.</span><span class="s2">&#34;&amp;lang=zh_CN&#34;</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>流程示例代码</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">oauth</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="nv">$data</span><span class="o">=</span><span class="nx">json_decode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;https://api.weixin.qq.com/sns/oauth2/access_token?appid=&#34;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">appid</span><span class="o">.</span><span class="s2">&#34;&amp;secret=&#34;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span><span class="o">.</span><span class="s2">&#34;&amp;code=&#34;</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;&amp;grant_type=authorization_code&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="nv">$userInfo</span><span class="o">=</span><span class="nx">json_decode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;https://api.w
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">         eixin.qq.com/sns/userinfo?access_token=&#34;</span><span class="o">.</span><span class="nv">$data</span><span class="o">-&gt;</span><span class="na">access_token</span><span class="o">.</span><span class="s2">&#34;&amp;openid=&#34;</span><span class="o">.</span><span class="nv">$data</span><span class="o">-&gt;</span><span class="na">openid</span><span class="o">.</span><span class="s2">&#34;&amp;lang=zh_CN&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="nv">$user</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;openid&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$userInfo</span><span class="o">-&gt;</span><span class="na">openid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;nickname&#39;</span>     <span class="o">=&gt;</span> <span class="nv">$userInfo</span><span class="o">-&gt;</span><span class="na">nickname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;headimgurl&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userInfo</span><span class="o">-&gt;</span><span class="na">headimgurl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">set_userdata</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">replace</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;client&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="k">echo</span> <span class="s2">&#34;出现未知错误，如果重复出现该错误，请联系开发者。错误代码:Oauth:10203&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h3 id="php密码操作php-5--550-php-7">php密码操作(PHP 5 &gt;= 5.5.0, PHP 7)</h3>
<ol>
<li>加密操作:<code>string password_hash ( string $password , int $algo [, array $options ] )</code></li>
</ol>
<blockquote>
<p>示例:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">password_hash</span><span class="p">(</span><span class="s2">&#34;admin&#34;</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">);</span> 
</span></span></code></pre></div><ol start="2">
<li>判断操作: <code>bool password_verify ( string $password , string $hash )</code></li>
</ol>
<blockquote>
<p>示例:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">password_verify</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$admin_data</span><span class="o">-&gt;</span><span class="na">row</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>

    
    <ins class="adsbygoogle"
         style="display:block; text-align:center;width: 100%"
         data-ad-client="ca-pub-3208634444966567"
         data-ad-format="fluid"
         data-ad-layout="in-article"
         data-ad-slot="2621880404">
    </ins>
</div>

    </main>

    
    <footer class="footer">
        <div class="container">
            <span>Copyright © 2017-2025 指尖魔法屋. All rights reserved</span>
            <span>POWERED BY thinkBlog · v1.0.0</span>
            <span>网站持续搭建中，感谢关注</span>
            <div class="beian">
                <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备17055617号</a>
            </div>
        </div>
    </footer>

    
    <script src="https://example.org/js/thinkblog.js"></script>
</body>
</html>
