<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Vue3使用customRef()主动触发响应更新 | 指尖魔法屋</title>

    
    <meta name="description" content="在vue3中（尤其是setup语法）vue框架会自动处理事件响应。但是假设有个场景，我们实现了一个数据结构，只要触发对应操作时，就刷新视图。这个问题在选项式API有个公共API，提供强制刷新能力，那就是`$forceUpdate()`。`$forceUpdate()`会全量刷新，而且组合式API不支持该方法，这个时候如果我们想主动触发视图更新，可以使用Vue3提供的customRef()自定义一个ref。">
    <meta name="keywords" content="前端, vuejs, vue">

    
    <meta property="og:title" content="Vue3使用customRef()主动触发响应更新">
    <meta property="og:description" content="在vue3中（尤其是setup语法）vue框架会自动处理事件响应。但是假设有个场景，我们实现了一个数据结构，只要触发对应操作时，就刷新视图。这个问题在选项式API有个公共API，提供强制刷新能力，那就是`$forceUpdate()`。`$forceUpdate()`会全量刷新，而且组合式API不支持该方法，这个时候如果我们想主动触发视图更新，可以使用Vue3提供的customRef()自定义一个ref。">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://blog.thinkmoon.cn/post/975_vue3%E4%BD%BF%E7%94%A8customref__%E4%B8%BB%E5%8A%A8%E8%A7%A6%E5%8F%91%E5%93%8D%E5%BA%94%E6%9B%B4%E6%96%B0/">
    
    <meta property="og:image" content="https://blog.cdn.thinkmoon.cn/2022-12-12/21-07-40">
    

    
    <link rel="icon" href="/favicon.ico">

    
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/github-markdown.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
    
    
    <nav class="top-menu">
        <div class="container">
            <div class="left">
                <a href="/">指尖魔法屋</a>
            </div>
            <ul class="menu">
                <li class="">
                    <a href="/">首页</a>
                </li>
                <li class="">
                    <a href="/categories/">分类</a>
                </li>
                <li class="">
                    <a href="/tags/">标签</a>
                </li>
            </ul>
            <div class="right">
                <a href="/admin" class="admin-link">
                    <span>登录</span>
                </a>
            </div>
        </div>
    </nav>
    

    
    <main>
        
<div class="article-content">
    <div class="markdown-body">
        <p><img src="https://blog.cdn.thinkmoon.cn/2022-12-12/21-07-40" alt="customRef()"></p>
<h2 id="前言">前言</h2>
<p>在vue3中（尤其是setup语法）vue框架会自动处理事件响应。但是假设有个场景，我们实现了一个数据结构，只要触发对应操作时，就刷新视图。这个问题在选项式API有个公共API，提供强制刷新能力，那就是<code>$forceUpdate()</code>。<code>$forceUpdate()</code>会全量刷新，而且组合式API不支持该方法，这个时候如果我们想主动触发视图更新，可以使用Vue3提供的<code>customRef()</code>自定义一个ref。</p>
<h2 id="介绍">介绍</h2>
<p>customRef()，创建一个自定义的 ref，显式声明对其依赖追踪和更新触发的控制方式。</p>
<p>形如</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">customRef</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">factory</span>: <span class="kt">CustomRefFactory</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span><span class="o">:</span> <span class="nx">Ref</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">CustomRefFactory</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">track</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">trigger</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">get</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span>
</span></span><span class="line"><span class="cl">  <span class="kr">set</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>其中，track函数告诉框架这是一个需要追踪变更的变量，一般在get里面调用。trigger则是数据变化时调用，用以通知框架，该变量已发生变化触发视图更新。</p>
<h2 id="示例">示例</h2>
<blockquote>
<p>实现一个日志展示功能，当日志增加时，触发视图更新</p>
</blockquote>
<p><img src="https://blog.cdn.thinkmoon.cn/2022-12-12/21-53-09" alt="Description"></p>
<p>这是一个简陋的日志系统，永远展示最后十条日志(截图少了个.slice(-10))。而且我在程序最后加了个定时器，每隔一秒定时增加一条日志。</p>
<p>从图中的结果可以发现，对应的数据变化并未相应的渲染在视图上。这个使用我们就需要customRef实现一个自定义的ref，当日志增加时主动触发trigger通知视图更新</p>
<h2 id="使用customref改造">使用customRef改造</h2>
<p><img src="https://blog.cdn.thinkmoon.cn/2022-12-12/22-03-09" alt="Description"></p>
<h2 id="总结">总结</h2>
<p>使用customRef的好处就是可以把trigger暴露到外部，直接触发trigger就会触发刷新，实现按需加载的效果。</p>

    </div>

    
    <ins class="adsbygoogle"
         style="display:block; text-align:center;width: 100%"
         data-ad-client="ca-pub-3208634444966567"
         data-ad-format="fluid"
         data-ad-layout="in-article"
         data-ad-slot="2621880404">
    </ins>
</div>

    </main>

    
    <footer class="footer">
        <div class="container">
            <span>Copyright © 2017-2025 指尖魔法屋. All rights reserved</span>
            <span>POWERED BY thinkBlog · v1.0.0</span>
            <span>网站持续搭建中，感谢关注</span>
            <div class="beian">
                <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备17055617号</a>
            </div>
        </div>
    </footer>

    
    <script src="/js/thinkblog.js"></script>
</body>
</html>
