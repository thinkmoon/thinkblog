<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>使用CloudFlare反向代理七牛云存储实现SSL自由 | 指尖魔法屋</title>

    
    <meta name="description" content="在混合云架构实践中，如何为第三方存储服务实现零成本HTTPS加密一直是开发者关注的焦点。本文将深入解析通过CloudFlare Workers反向代理技术，为七牛云存储资源构建全自动SSL加密体系的完整方案。该方案不仅规避了传统SSL证书部署的复杂流程，还能实现全球CDN加速与内容安全策略的统一管控。">
    <meta name="keywords" content="CDN加速, 云存储, 网络安全">

    
    <meta property="og:title" content="使用CloudFlare反向代理七牛云存储实现SSL自由">
    <meta property="og:description" content="在混合云架构实践中，如何为第三方存储服务实现零成本HTTPS加密一直是开发者关注的焦点。本文将深入解析通过CloudFlare Workers反向代理技术，为七牛云存储资源构建全自动SSL加密体系的完整方案。该方案不仅规避了传统SSL证书部署的复杂流程，还能实现全球CDN加速与内容安全策略的统一管控。">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/post/985_%E4%BD%BF%E7%94%A8cloudflare%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%83%E7%89%9B%E4%BA%91%E5%AD%98%E5%82%A8%E5%AE%9E%E7%8E%B0ssl%E8%87%AA%E7%94%B1/">
    

    
    <link rel="icon" href="/favicon.ico">

    
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/github-markdown.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
    
    
    <nav class="top-menu">
        <div class="container">
            <div class="left">
                <a href="/">指尖魔法屋</a>
            </div>
            <ul class="menu">
                <li class="">
                    <a href="/">首页</a>
                </li>
                <li class="">
                    <a href="/categories/">分类</a>
                </li>
                <li class="">
                    <a href="/tags/">标签</a>
                </li>
            </ul>
            <div class="right">
                <a href="/admin" class="admin-link">
                    <span>登录</span>
                </a>
            </div>
        </div>
    </nav>
    

    
    <main>
        
<div class="article-content">
    <div class="markdown-body">
        <h1 id="基于cloudflare-workers的七牛云https代理方案">基于CloudFlare Workers的七牛云HTTPS代理方案</h1>
<h2 id="一方案背景与核心价值">一、方案背景与核心价值</h2>
<h3 id="11-问题场景">1.1 问题场景</h3>
<p>七牛云存储作为国内主流对象存储服务，其HTTP直连访问存在两大痛点：</p>
<ul>
<li><strong>SSL证书成本</strong>：自定义域名HTTPS服务需单独购买证书</li>
<li><strong>混合内容风险</strong>：主站HTTPS页面加载HTTP资源触发安全警告</li>
</ul>
<h3 id="12-技术选型">1.2 技术选型</h3>
<p>通过CloudFlare Workers实现四大核心能力：</p>
<ul>
<li><strong>协议转换层</strong>：将用户HTTPS请求转换为对七牛HTTP源站的请求</li>
<li><strong>动态内容改写</strong>：实时替换响应中的HTTP资源链接</li>
<li><strong>全局缓存加速</strong>：利用全球CDN节点提升访问速度</li>
<li><strong>零运维成本</strong>：无需维护服务器基础设施</li>
</ul>
<h2 id="二原理说明">二、原理说明</h2>
<p>Cloudflare Worker 是一个无服务器计算平台，通过拦截请求并修改响应实现代理。核心思路是：</p>
<p>将用户 HTTPS 请求转发到原始 HTTP 站点。
修改响应头，强制 HTTPS 协议并修复混合内容问题。</p>
<h2 id="三操作步骤">三、操作步骤</h2>
<h3 id="1-创建-cloudflare-worker">1. 创建 Cloudflare Worker</h3>
<ul>
<li>登录 Cloudflare 控制台 → Workers &amp; Pages → 创建新 Worker。</li>
<li>进入代码编辑界面。</li>
</ul>
<h3 id="2-编写代理脚本">2. 编写代理脚本</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Javascript" data-lang="Javascript"><span class="line"><span class="cl"><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span><span class="nx">handleRequest</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="kd">function</span> <span class="nx">handleRequest</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 替换为你的 HTTP 源站地址 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">originUrl</span> <span class="o">=</span> <span class="s1">&#39;http://your-http-site.com&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// 构建指向 HTTP 源站的新请求 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">newRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">(</span><span class="nx">originUrl</span> <span class="o">+</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span>  <span class="o">+</span> <span class="nx">url</span><span class="p">.</span><span class="nx">search</span><span class="p">,</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">headers</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">method</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">body</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span>  
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 发送请求并获取响应 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">newRequest</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// 修改响应头强制 HTTPS 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">modifiedHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="nx">modifiedHeaders</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">,</span>  <span class="s2">&#34;upgrade-insecure-requests&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modifiedHeaders</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;Content-Security-Policy-Report-Only&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 返回处理后的响应 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">status</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">headers</span><span class="o">:</span> <span class="nx">modifiedHeaders</span> 
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="3-部署并配置路由">3. 部署并配置路由</h3>
<ol>
<li>点击 Deploy 部署 Worker。</li>
<li>在 Worker 设置中绑定自定义域名（如 <a href="https://proxy.your-domain.com">https://proxy.your-domain.com</a> ）。</li>
</ol>
<h3 id="4-调整-ssltls-模式">4. 调整 SSL/TLS 模式</h3>
<ol>
<li>进入 Cloudflare 域名控制台 → SSL/TLS → 概述。</li>
<li>选择 Flexible 模式（允许 Cloudflare 通过 HTTPS 连接用户，但到源站使用 HTTP）。</li>
</ol>

    </div>

    
    <ins class="adsbygoogle"
         style="display:block; text-align:center;width: 100%"
         data-ad-client="ca-pub-3208634444966567"
         data-ad-format="fluid"
         data-ad-layout="in-article"
         data-ad-slot="2621880404">
    </ins>
</div>

    </main>

    
    <footer class="footer">
        <div class="container">
            <span>Copyright © 2017-2025 指尖魔法屋. All rights reserved</span>
            <span>POWERED BY thinkBlog · v1.0.0</span>
            <span>网站持续搭建中，感谢关注</span>
            <span id="site-timer">本站已顽强运行：计算中...</span>
            <div class="beian">
                <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备17055617号</a>
            </div>
        </div>
    </footer>

    
    <script>
      
      console.log('JavaScript loaded successfully');
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded event fired');
        const timerElement = document.getElementById('site-timer');
        if (timerElement) {
          console.log('Found timer element:', timerElement);
          timerElement.textContent = 'JavaScript is working!';
        } else {
          console.log('Timer element not found');
        }
      });
    </script>
    <script src="/js/thinkblog.js"></script>
</body>
</html>
