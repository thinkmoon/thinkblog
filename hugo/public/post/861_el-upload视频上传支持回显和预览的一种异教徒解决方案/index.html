<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>el-upload视频上传支持回显和预览的一种异教徒解决方案 | 指尖魔法屋</title>

    
    <meta name="description" content="该文章为异教徒解决方案，各位看官看下即可，切勿模仿！！！">
    <meta name="keywords" content="前端, element-ui, vue">

    
    <meta property="og:title" content="el-upload视频上传支持回显和预览的一种异教徒解决方案">
    <meta property="og:description" content="该文章为异教徒解决方案，各位看官看下即可，切勿模仿！！！">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/post/861_el-upload%E8%A7%86%E9%A2%91%E4%B8%8A%E4%BC%A0%E6%94%AF%E6%8C%81%E5%9B%9E%E6%98%BE%E5%92%8C%E9%A2%84%E8%A7%88%E7%9A%84%E4%B8%80%E7%A7%8D%E5%BC%82%E6%95%99%E5%BE%92%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">
    
    <meta property="og:image" content="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-06-03T05:42:34.png">
    

    
    <link rel="icon" href="/favicon.ico">

    
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/github-markdown.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
    
    
    <nav class="top-menu">
        <div class="container">
            <div class="left">
                <a href="/">指尖魔法屋</a>
            </div>
            <ul class="menu">
                <li class="">
                    <a href="/">首页</a>
                </li>
                <li class="">
                    <a href="/categories/">分类</a>
                </li>
                <li class="">
                    <a href="/tags/">标签</a>
                </li>
            </ul>
            <div class="right">
                <a href="/admin" class="admin-link">
                    <span>登录</span>
                </a>
            </div>
        </div>
    </nav>
    

    
    <main>
        
<div class="article-content">
    <div class="markdown-body">
        <blockquote>
<p>该文章为异教徒解决方案，各位看官看下即可，切勿模仿！！！</p>
</blockquote>
<h2 id="问题描述">问题描述</h2>
<p>原生的el-upload只支持上传图片时候的预览和回显，这是因为只针对img标签做了适配，如下图。</p>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-06-03T05:42:34.png" alt="2020-06-03T05:42:34.png"></p>
<p>而如果我们上传视频，则会出现一个白方框，用户体验不佳。</p>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-06-03T05:45:07.png" alt="2020-06-03T05:45:07.png"></p>
<h2 id="解决思路">解决思路</h2>
<p>其实正确的解决思路应该是</p>
<ol>
<li>
<p>将<code>show-file-list</code>属性设置为<code>false</code>。然后再自己循环显示file-list，以及追加对应的预览，删除按钮及功能。</p>
</li>
<li>
<p>设置自定义模板内容(推荐使用)</p>
</li>
</ol>
<p>但是我觉得这样太麻烦了(时间问题）。</p>
<p>于是我突发奇想，如果我将img标签改成video标签呢？如下图</p>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-06-03T05:46:56.png" alt="2020-06-03T05:46:56.png"></p>
<p>发现居然完美契合，毫无违和感。</p>
<h2 id="预览的实现">预览的实现</h2>
<p>在做到把img改为video标签之前，还需要解决的另一个问题就是，如何让视频也支持预览。老规矩，我们先来看看官方Demo怎么实现预览的。</p>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-06-03T05:54:03.png" alt="2020-06-03T05:54:03.png"></p>
<p>官方的做法是增加一个dialog，然后在点击预览图片时将文件url传给dialog。我们先来实现一下改写一下dialog</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">el-dialog</span> <span class="nt">:visible.sync</span><span class="s">=&#34;dialogVisible&#34;</span> <span class="nt">:modal-append-to-body</span><span class="s">=&#34;true&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">video</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100%&#34;</span> <span class="na">muted</span> <span class="na">autoplay</span><span class="o">=</span><span class="s">&#34;autoplay&#34;</span> <span class="na">loop</span><span class="o">=</span><span class="s">&#34;loop&#34;</span> <span class="nt">v-if</span><span class="s">=&#34;dialogImageUrl[dialogImageUrl.length - 1] == 4&#34; </span><span class="nt">:src</span><span class="s">=&#34;dialogImageUrl&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">video</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100%&#34;</span> <span class="na">v</span><span class="nt">-else</span> <span class="nt">:src</span><span class="s">=&#34;dialogImageUrl&#34;</span> <span class="na">alt</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/el-dialog&gt;</span>
</span></span></code></pre></div><blockquote>
<p>tips: 我这种判断MP4格式的方式实属异端，不建议模仿。</p>
</blockquote>
<h2 id="替换img标签">替换img标签</h2>
<p>一到标签节点的操作，我第一想到的就是document操作（异端+1），直接上代码。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">changeVideoTag</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">videoTag</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.video img&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;检测到应为video的img标签&#39;</span><span class="p">,</span> <span class="nx">videoTag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="nx">videoTag</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">videoTag</span><span class="p">.</span><span class="nx">parentNode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">newElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">newElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="nx">videoTag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">newElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">videoTag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">newElement</span><span class="p">,</span> <span class="nx">videoTag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span></code></pre></div><p>该函数负责寻找video类下的img标签，然后在img标签之前，添加一个同样的videos元素节点，此处你可以选择是否移除原img标签。</p>
<h2 id="最终实现效果">最终实现效果</h2>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/gif.gif" alt="gif.gif"></p>
<h2 id="最后的话">最后的话</h2>
<ol>
<li>
<p>这种方法非常不推荐使用，强烈建议使用自定义模板缩略图</p>
</li>
<li>
<p>这种方法非常不推荐使用，强烈建议使用自定义模板缩略图</p>
</li>
<li>
<p>这种方法非常不推荐使用，强烈建议使用自定义模板缩略图</p>
</li>
</ol>

    </div>

    
    <ins class="adsbygoogle"
         style="display:block; text-align:center;width: 100%"
         data-ad-client="ca-pub-3208634444966567"
         data-ad-format="fluid"
         data-ad-layout="in-article"
         data-ad-slot="2621880404">
    </ins>
</div>

    </main>

    
    <footer class="footer">
        <div class="container">
            <span>Copyright © 2017-2025 指尖魔法屋. All rights reserved</span>
            <span>POWERED BY thinkBlog · v1.0.0</span>
            <span>网站持续搭建中，感谢关注</span>
            <span id="site-timer">本站已顽强运行：计算中...</span>
            <div class="beian">
                <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备17055617号</a>
            </div>
        </div>
    </footer>

    
    <script src="/js/thinkblog.js"></script>
</body>
</html>
