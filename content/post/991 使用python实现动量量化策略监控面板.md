

---
title: ä½¿ç”¨pythonå®ç°åŠ¨é‡é‡åŒ–ç­–ç•¥ç›‘æ§é¢æ¿
date: '2025-12-22 10:00:00'
lastmod: '2025-12-22 10:00:00'
categories:
- æŠ€æœ¯å®è·µ
tags:
- åŠ¨é‡
- é‡åŒ–
- Python
- Streamlit
- AkShare
description: åŸºäº Python çš„åŠ¨é‡è½®åŠ¨é‡åŒ–ç­–ç•¥ç›‘æ§é¢æ¿ï¼Œä½¿ç”¨ AkShare è·å–æ•°æ®ï¼ŒStreamlit å¯è§†åŒ–å±•ç¤ºå¹¶æä¾›å›æµ‹ç¤ºä¾‹ã€‚
featured_image: https://cdn.jsdelivr.net/gh/thinkmoon/pic@master/images/3d373cc29b5472532d4b9cf94d03be80.png
---

# ä½¿ç”¨pythonå®ç°åŠ¨é‡é‡åŒ–ç­–ç•¥ç›‘æ§é¢æ¿

## 1. ä»€ä¹ˆæ˜¯åŠ¨é‡ç­–ç•¥ï¼Ÿ

åœ¨é‡‘èå¸‚åœºä¸­ï¼ŒåŠ¨é‡æ•ˆåº”ï¼ˆMomentum Effectï¼‰è¢«èª‰ä¸ºâ€œé‡‘èç•Œçš„ç‰›é¡¿ç¬¬ä¸€å®šå¾‹â€ã€‚å®ƒçš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š**å¼ºè€…æ’å¼º**ã€‚

åŠ¨é‡ç­–ç•¥ä¸å…³æ³¨å…¬å¸çš„è´¢åŠ¡æŠ¥è¡¨ï¼Œä¹Ÿä¸å…³å¿ƒåŸºæœ¬é¢ä¼°å€¼ï¼Œå®ƒåªçœ‹ä»·æ ¼è¶‹åŠ¿ã€‚

å®ƒå‡è®¾è¿‡å»ä¸€æ®µæ—¶é—´è¡¨ç°æœ€å¥½çš„èµ„äº§ï¼Œåœ¨æœªæ¥çš„ä¸€æ®µæ—¶é—´å†…å¤§æ¦‚ç‡ä¼šç»§ç»­è¡¨ç°è‰¯å¥½ï¼›åä¹‹ï¼Œè¿‡å»è¡¨ç°æœ€å·®çš„èµ„äº§ï¼Œæœªæ¥å¤§æ¦‚ç‡ä¼šç»§ç»­ä¸‹è·Œã€‚è¿™æ˜¯ä¸€ç§**â€œè¿½æ¶¨æ€è·Œâ€**çš„ç­–ç•¥ï¼Œä½†ä¸åŒäºæ•£æˆ·çš„æƒ…ç»ªåŒ–æ“ä½œï¼Œå®ƒæ˜¯åŸºäºä¸¥æ ¼çš„æ•°æ®å›æµ‹å’Œçºªå¾‹æ‰§è¡Œçš„ã€‚


## 2. æ ‡çš„é€‰æ‹©ï¼šæ„å»ºâ€œå¾®å‹å…¨å¤©å€™â€ç»„åˆ

ä¸ºäº†æé«˜ç­–ç•¥çš„ç¨³å¥æ€§ï¼Œæˆ‘ä»¬ä¸å»ºè®®åªåœ¨å•ä¸€è‚¡å¸‚å†…éƒ¨å¯»æ‰¾åŠ¨é‡ã€‚åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œæˆ‘ä»¬é€‰å–äº†äº”ä¸ª**ä½ç›¸å…³æ€§**çš„è·¨å›½ã€è·¨ç±»åˆ«èµ„äº§ä½œä¸ºæ± å­ï¼š

1. **åˆ›ä¸šæ¿ ETF (159915)**ï¼šä»£è¡¨ A è‚¡é«˜å¼¹æ€§ã€ç§‘æŠ€æˆé•¿é£æ ¼ã€‚
2. **æ²ªæ·± 300 ETF (510300)**ï¼šä»£è¡¨ A è‚¡å¤§ç›˜ã€ä»·å€¼è“ç­¹é£æ ¼ã€‚
3. **çº³æŒ‡ 100 ETF (513100)**ï¼šä»£è¡¨å…¨çƒç§‘æŠ€é¾™å¤´ï¼Œä¸ A è‚¡å‘¨æœŸé”™ä½ã€‚
4. **é»„é‡‘ ETF (518880)**ï¼šç»å…¸çš„é¿é™©èµ„äº§ï¼Œåœ¨è‚¡å¸‚åŠ¨è¡æ—¶å¸¸æœ‰ç‹¬ç«‹è¡Œæƒ…ã€‚
5. **è´§å¸ ETF (511880)**ï¼šä½œä¸ºâ€œé˜²å¾¡æ¸¯æ¹¾â€ï¼Œå½“ä¸Šè¿°é£é™©èµ„äº§å…¨éƒ¨ç†„ç«æ—¶ï¼Œç”¨æ¥ä¿æŠ¤æœ¬é‡‘ã€‚


## 3. ç­–ç•¥é€»è¾‘è®¾è®¡

æˆ‘ä»¬è®¾è®¡çš„é‡åŒ–çœ‹æ¿éµå¾ªä»¥ä¸‹åŒé‡é€»è¾‘ï¼š

* **ç›¸å¯¹åŠ¨é‡ï¼ˆä¼˜ä¸­é€‰ä¼˜ï¼‰**ï¼šè®¡ç®—è¿™å››ä¸ªé£é™©èµ„äº§è¿‡å» $N$ å¤©ï¼ˆå¦‚ 20 å¤©ï¼‰çš„æ¶¨å¹…ï¼Œæ‰¾å‡ºè¡¨ç°æœ€å¼ºçš„é‚£ä¸€ä¸ªã€‚
* **ç»å¯¹åŠ¨é‡ï¼ˆæ­¢æŸé£æ§ï¼‰**ï¼šå¦‚æœè¡¨ç°æœ€å¼ºçš„èµ„äº§æ”¶ç›Šç‡ä¾ç„¶ä¸ºè´Ÿï¼ˆæˆ–è€…ä½äºè´§å¸åŸºé‡‘æ”¶ç›Šï¼‰ï¼Œè¯´æ˜å¸‚åœºæ•´ä½“ç¯å¢ƒæå·®ï¼Œæ­¤æ—¶ç­–ç•¥å¼ºåˆ¶åˆ‡æ¢è‡³ **è´§å¸ ETF** è¿›è¡Œç©ºä»“é¿é™©ã€‚


## 4. æŠ€æœ¯æ ˆå®ç°

ä¸ºäº†ä¿è¯ç¯å¢ƒçš„çº¯å‡€å’Œè¿è¡Œçš„æ€§èƒ½ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ä»¥ä¸‹é…ç½®æ–¹æ¡ˆï¼š

* **ç¯å¢ƒç®¡ç†**ï¼šConda (æ¨è Python 3.11 ç‰ˆæœ¬)ã€‚
* **æ•°æ®æ¥æº**ï¼šAkShare (å…è´¹å¼€æºçš„é‡‘èæ•°æ®æ¥å£åº“)ã€‚
* **å‰ç«¯å±•ç¤º**ï¼šStreamlit (æé€Ÿæ„å»º Web æ•°æ®çœ‹æ¿çš„åˆ©å™¨)ã€‚
* **äº¤äº’ç»˜å›¾**ï¼šPlotly (æä¾›å“åº”å¼çš„ç¼©æ”¾å›¾è¡¨)ã€‚

### æ ¸å¿ƒä»£ç å®ç°é€»è¾‘

åˆ›å»ºç¯å¢ƒ

```bash
conda create -n quant_lab python=3.11 -c conda-forge -y
conda activate quant_lab
```

å®‰è£…ç›¸å…³ä¾èµ–

```bash
pip install akshare streamlit plotly pandas matplotlib
```

é‡åŒ–ç­–ç•¥ç›‘æ§é¢æ¿

```python
import streamlit as st
import akshare as ak
import pandas as pd
import datetime
import plotly.express as px

# é¡µé¢é…ç½®
st.set_page_config(page_title="å…¨çƒèµ„äº§åŠ¨é‡è½®åŠ¨ç­–ç•¥", layout="wide")

# ===========================
# 1. ç­–ç•¥é…ç½®ä¸æ ‡çš„æ± 
# ===========================
st.sidebar.header("âš™ï¸ ç­–ç•¥å‚æ•°è®¾ç½®")

# æ ‡çš„æ± å®šä¹‰ (ä»£ç éœ€æ ¹æ®å®é™…ETFä»£ç è°ƒæ•´ï¼Œè¿™é‡Œé€‰å–äº†æµåŠ¨æ€§è¾ƒå¥½çš„ä»£è¡¨)
ASSETS = {
    "159915": "åˆ›ä¸šæ¿ETF",   # Aè‚¡æˆé•¿/ç§‘æŠ€
    "510300": "æ²ªæ·±300ETF",  # Aè‚¡è“ç­¹/å¤§ç›˜
    "513100": "çº³æŒ‡100ETF",  # ç¾è‚¡ç§‘æŠ€ (QDII)
    "518880": "é»„é‡‘ETF",     # é¿é™©/å¤§å®—å•†å“
    "511880": "é“¶åæ—¥åˆ©"     # è´§å¸/ç°é‡‘ç®¡ç† (é¿é™©æ¸¯æ¹¾)
}

# ç°é‡‘/é¿é™©èµ„äº§çš„ä»£ç 
CASH_ASSET_CODE = "511880"

# å‚æ•°è®¾ç½®
lookback_period = st.sidebar.number_input(
    "åŠ¨é‡å›é¡¾å‘¨æœŸ (å¤©)", 
    min_value=5, 
    max_value=250, 
    value=20, 
    step=1,
    help="è®¡ç®—è¿‡å»å¤šå°‘å¤©çš„æ”¶ç›Šç‡ä½œä¸ºåŠ¨é‡æŒ‡æ ‡ã€‚å¸¸ç”¨ï¼š20å¤©(æœˆé¢‘)ã€60å¤©(å­£é¢‘)ã€‚"
)

top_n = 1  # åŠ¨é‡ç­–ç•¥é€šå¸¸åªæŒæœ‰ç¬¬1å

st.title("ğŸš€ å…¨çƒèµ„äº§åŠ¨é‡è½®åŠ¨ç­–ç•¥çœ‹æ¿")
st.markdown(f"**ç­–ç•¥é€»è¾‘**ï¼šè®¡ç®—è¿‡å» **{lookback_period}ä¸ªäº¤æ˜“æ—¥** çš„æ¶¨å¹…ã€‚æŒæœ‰æ’åç¬¬ä¸€çš„èµ„äº§ã€‚å¦‚æœæ’åç¬¬ä¸€çš„èµ„äº§æ”¶ç›Šç‡ä¸ºè´Ÿï¼Œåˆ™åˆ‡æ¢è‡³è´§å¸ETFã€‚")

# ===========================
# 2. æ•°æ®è·å–å‡½æ•° (ä½¿ç”¨ç¼“å­˜åŠ é€Ÿ)
# ===========================
@st.cache_data(ttl=3600)  # ç¼“å­˜1å°æ—¶ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
def get_market_data(assets_dict, period_days):
    df_list = []
    
    # è·å–å½“å‰æ—¥æœŸå’Œæ¨ç®—çš„èµ·å§‹æ—¥æœŸï¼ˆå¤šå–ä¸€äº›æ•°æ®ä»¥ç¡®ä¿è®¡ç®—å‡†ç¡®ï¼‰
    end_date = datetime.datetime.now().strftime("%Y%m%d")
    start_date = (datetime.datetime.now() - datetime.timedelta(days=period_days*2 + 30)).strftime("%Y%m%d")

    progress_bar = st.progress(0)
    status_text = st.empty()
    
    total = len(assets_dict)
    count = 0

    for code, name in assets_dict.items():
        count += 1
        status_text.text(f"æ­£åœ¨è·å– {name} ({code}) æ•°æ®...")
        progress_bar.progress(count / total)
        
        try:
            # ä½¿ç”¨ AkShare è·å– ETF å†å²è¡Œæƒ…
            stock_data = ak.fund_etf_hist_em(symbol=code, period="daily", start_date=start_date, end_date=end_date)
            
            if stock_data.empty:
                continue

            # æ•´ç†æ•°æ®
            stock_data['æ—¥æœŸ'] = pd.to_datetime(stock_data['æ—¥æœŸ'])
            stock_data = stock_data.sort_values('æ—¥æœŸ')
            
            # è·å–æœ€æ–°ä»·æ ¼å’ŒNå¤©å‰ä»·æ ¼
            if len(stock_data) >= period_days:
                latest_price = stock_data.iloc[-1]['æ”¶ç›˜']
                latest_date = stock_data.iloc[-1]['æ—¥æœŸ'].strftime("%Y-%m-%d")
                
                # Nå¤©å‰çš„ä»·æ ¼ (ç”¨äºè®¡ç®—åŠ¨é‡)
                # æ³¨æ„ï¼šå®é™…äº¤æ˜“ä¸­è¦é˜²æ­¢ç”±äºåœç‰Œç­‰å¯¼è‡´çš„å¤©æ•°ä¸å¯¹ï¼Œè¿™é‡Œåšç®€åŒ–å¤„ç†
                prev_price = stock_data.iloc[-1 - period_days]['æ”¶ç›˜']
                
                # è®¡ç®—æ”¶ç›Šç‡ (åŠ¨é‡)
                momentum = (latest_price - prev_price) / prev_price * 100
                
                df_list.append({
                    "ä»£ç ": code,
                    "åç§°": name,
                    "æœ€æ–°æ—¥æœŸ": latest_date,
                    "å½“å‰ä»·æ ¼": latest_price,
                    f"{period_days}æ—¥æ¶¨å¹…(%)": round(momentum, 2),
                    "å†å²æ•°æ®": stock_data  # å­˜å…¥å†å²æ•°æ®ç”¨äºç”»å›¾
                })
        except Exception as e:
            st.error(f"è·å– {name} æ•°æ®å¤±è´¥: {e}")
            
    status_text.empty()
    progress_bar.empty()
    
    return pd.DataFrame(df_list)

# ===========================
# 3. æ ¸å¿ƒé€»è¾‘ä¸å±•ç¤º
# ===========================

period_days = lookback_period  # åˆ«åè¡¥ä¸ï¼Œé˜²æ­¢å˜é‡åä¸ç»Ÿä¸€æŠ¥é”™

if st.button("ğŸ”„ åˆ·æ–°æ•°æ® / è¿è¡Œç­–ç•¥", type="primary"):
    df = get_market_data(ASSETS, lookback_period)

    if not df.empty:
        # 1. æ’å
        df = df.sort_values(by=f"{period_days}æ—¥æ¶¨å¹…(%)", ascending=False).reset_index(drop=True)
        
        # 2. ç­–ç•¥åˆ¤å®š
        top_asset = df.iloc[0]
        top_name = top_asset['åç§°']
        top_momentum = top_asset[f"{period_days}æ—¥æ¶¨å¹…(%)"]
        
        # è´§å¸ETFçš„ä¿¡æ¯
        cash_row = df[df['ä»£ç '] == CASH_ASSET_CODE]
        cash_name = "è´§å¸ETF"
        if not cash_row.empty:
            cash_name = cash_row.iloc[0]['åç§°']

        st.divider()
        
        # === ä¿¡å·å±•ç¤ºåŒº ===
        col1, col2 = st.columns([2, 1])
        
        with col1:
            st.subheader("ğŸ“¢ æœ¬æœŸäº¤æ˜“ä¿¡å·")
            
            # é€»è¾‘åˆ¤æ–­ï¼šç»å¯¹åŠ¨é‡æ£€æŸ¥
            # å¦‚æœç¬¬ä¸€åæ˜¯è´§å¸ETFï¼Œæˆ–è€…ç¬¬ä¸€åçš„æ¶¨å¹… <= 0ï¼Œåˆ™æŒæœ‰è´§å¸
            # æ³¨æ„ï¼šå¦‚æœè´§å¸ETFæœ¬èº«æ’ç¬¬ä¸€ï¼Œé‚£è‡ªç„¶ä¹°è´§å¸
            
            is_defensive = False
            final_target = top_name
            
            if top_momentum <= 0 and top_asset['ä»£ç '] != CASH_ASSET_CODE:
                is_defensive = True
                final_target = cash_name
                st.warning(f"âš ï¸ è­¦æŠ¥ï¼šæ’åç¬¬ä¸€çš„ {top_name} æ”¶ç›Šç‡ä¸ºè´Ÿ ({top_momentum}%)ï¼Œè§¦å‘ç»å¯¹åŠ¨é‡é£æ§ã€‚")
                st.success(f"âœ… **å»ºè®®æŒä»“ï¼š{final_target} ({CASH_ASSET_CODE})** [é¿é™©æ¨¡å¼]")
            else:
                st.success(f"âœ… **å»ºè®®æŒä»“ï¼š{final_target} ({top_asset['ä»£ç ']})** [è¿›æ”»æ¨¡å¼]")
                st.info(f"ç†ç”±ï¼š{top_name} åœ¨è¿‡å» {lookback_period} å¤©è¡¨ç°æœ€å¼ºï¼Œä¸”è¶‹åŠ¿å‘ä¸Šã€‚")

        with col2:
            st.metric(label=f"å½“å‰æœ€å¼º ({top_name}) åŠ¨é‡", value=f"{top_momentum}%")

        # === æ’è¡Œæ¦œè¡¨æ ¼ ===
        st.subheader("ğŸ“Š èµ„äº§åŠ¨é‡æ’è¡Œæ¦œ")
        
        # æ ¼å¼åŒ–æ˜¾ç¤ºï¼Œé«˜äº®å‰ä¸‰å
        def highlight_top(s):
            is_max = s == s.max()
            return ['background-color: #d4edda' if v else '' for v in is_max]

        st.dataframe(
            df[["ä»£ç ", "åç§°", "å½“å‰ä»·æ ¼", f"{period_days}æ—¥æ¶¨å¹…(%)", "æœ€æ–°æ—¥æœŸ"]],
            use_container_width=True,
            hide_index=True
        )

        # === å¯è§†åŒ–å›¾è¡¨ ===
        st.subheader("ğŸ“ˆ æ”¶ç›Šç‡èµ°åŠ¿å¯¹æ¯” (å½’ä¸€åŒ–)")
        
        # åˆå¹¶æ‰€æœ‰æ ‡çš„çš„å†å²æ•°æ®è¿›è¡Œç»˜å›¾
        plot_df = pd.DataFrame()
        for index, row in df.iterrows():
            hist_data = row['å†å²æ•°æ®']
            # æˆªå–æœ€è¿‘ N*2 å¤©çš„æ•°æ®ç”»å›¾
            display_days = lookback_period * 2
            subset = hist_data.tail(display_days).copy()
            # å½’ä¸€åŒ–ï¼šè®©èµ·ç‚¹éƒ½å˜æˆ 1
            start_price = subset.iloc[0]['æ”¶ç›˜']
            subset['ç´¯è®¡å‡€å€¼'] = subset['æ”¶ç›˜'] / start_price
            subset['åç§°'] = row['åç§°']
            plot_df = pd.concat([plot_df, subset])

        fig = px.line(
            plot_df, 
            x='æ—¥æœŸ', 
            y='ç´¯è®¡å‡€å€¼', 
            color='åç§°',
            title=f'è¿‡å» {lookback_period*2} å¤©å„èµ„äº§èµ°åŠ¿å¯¹æ¯” (èµ·ç‚¹å½’ä¸€)',
            markers=False
        )
        st.plotly_chart(fig, use_container_width=True)

    else:
        st.error("æœªèƒ½è·å–æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åå†è¯•ã€‚")

else:
    st.info("ğŸ‘ˆ è¯·åœ¨å·¦ä¾§è°ƒæ•´å‚æ•°ï¼Œå¹¶ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹åˆ†æã€‚")

# ä¾§è¾¹æ è¯´æ˜
st.sidebar.markdown("---")
st.sidebar.markdown("""
### ğŸ’¡ è¯´æ˜
1. **æ•°æ®æ¥æº**ï¼šä¸œæ–¹è´¢å¯Œ (via AkShare)ã€‚
2. **çº³æŒ‡ETF**ï¼šå› æ¶‰åŠQDIIï¼Œæ•°æ®å¯èƒ½æ¯”Aè‚¡èµ„äº§æ»åä¸€å¤©ã€‚
3. **è´§å¸ETF**ï¼šä½œä¸ºé£æ§é”šç‚¹ã€‚å½“æ‰€æœ‰é£é™©èµ„äº§åŠ¨é‡å‡å°äº0æ—¶ï¼Œåº”åˆ‡æ¢è‡³è´§å¸ETFã€‚
""")
```

![3d373cc29b5472532d4b9cf94d03be80](https://cdn.jsdelivr.net/gh/thinkmoon/pic@master/images/3d373cc29b5472532d4b9cf94d03be80.png)

## 5. ç»“æœå›æµ‹

å›æµ‹ä»£ç 

```python
import akshare as ak
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import datetime

# ===========================
# 1. å›æµ‹é…ç½®
# ===========================
# è®¾ç½®ä¸­æ–‡æ˜¾ç¤ºï¼ˆé˜²æ­¢ç»˜å›¾ä¹±ç ï¼‰
plt.rcParams['font.sans-serif'] = ['SimHei'] 
plt.rcParams['axes.unicode_minus'] = False

ASSETS = {
    "159915": "åˆ›ä¸šæ¿ETF",
    "510300": "æ²ªæ·±300ETF",
    "513100": "çº³æŒ‡100ETF",
    "518880": "é»„é‡‘ETF",
    "511880": "é“¶åæ—¥åˆ©"
}

START_DATE = "20200101"
END_DATE = datetime.datetime.now().strftime("%Y%m%d")
LOOKBACK = 20  # åŠ¨é‡çª—å£
REBALANCE_FREQ = 20  # è°ƒä»“é¢‘ç‡ï¼ˆæ¯20ä¸ªäº¤æ˜“æ—¥è°ƒä¸€æ¬¡ä»“ï¼‰

def get_data(code, name):
    print(f"æ­£åœ¨è·å– {name} å†å²æ•°æ®...")
    df = ak.fund_etf_hist_em(symbol=code, period="daily", start_date=START_DATE, end_date=END_DATE)
    df = df[['æ—¥æœŸ', 'æ”¶ç›˜']]
    df.columns = ['date', name]
    df['date'] = pd.to_datetime(df['date'])
    return df.set_index('date')

# ===========================
# 2. æ•°æ®å‡†å¤‡
# ===========================
# åˆå¹¶æ‰€æœ‰æ ‡çš„ä»·æ ¼æ•°æ®
all_prices = []
for code, name in ASSETS.items():
    all_prices.append(get_data(code, name))

data = pd.concat(all_prices, axis=1).fillna(method='ffill').dropna()

# ===========================
# 3. æ¨¡æ‹Ÿå›æµ‹é€»è¾‘
# ===========================
def run_backtest(df, lookback, freq):
    # è®¡ç®—æ¯æ—¥æ”¶ç›Šç‡
    returns = df.pct_change()
    
    # ç­–ç•¥å‡€å€¼ï¼Œåˆå§‹ä¸º1
    strategy_net_value = [1.0]
    # åŸºå‡†å‡€å€¼ï¼ˆç­‰æƒé‡æŒæœ‰ï¼‰
    benchmark_net_value = [1.0]
    
    current_asset = None
    
    # ä»lookbackå¼€å§‹æ¨¡æ‹Ÿï¼Œå› ä¸ºéœ€è¦å…ˆè®¡ç®—åŠ¨é‡
    for i in range(lookback, len(df)):
        # åˆ¤å®šæ˜¯å¦åˆ°äº†è°ƒä»“æ—¥
        if (i - lookback) % freq == 0:
            # 1. è®¡ç®—è¿‡å»lookbackå¤©çš„æ¶¨å¹…
            momentum = (df.iloc[i-1] - df.iloc[i-lookback]) / df.iloc[i-lookback]
            
            # 2. é€‰å‡ºæœ€å¼ºæ ‡çš„
            top_asset = momentum.idxmax()
            top_value = momentum.max()
            
            # 3. ç»å¯¹åŠ¨é‡è¿‡æ»¤ï¼šå¦‚æœæœ€å¼ºæ ‡çš„æ¶¨å¹…<=0ï¼Œåˆ™åˆ‡æ¢åˆ°è´§å¸ETF
            if top_value <= 0:
                current_asset = "é“¶åæ—¥åˆ©"
            else:
                current_asset = top_asset
        
        # è®¡ç®—å½“æ—¥ç­–ç•¥æ”¶ç›Š
        daily_return = returns.iloc[i][current_asset]
        strategy_net_value.append(strategy_net_value[-1] * (1 + daily_return))
        
        # è®¡ç®—åŸºå‡†æ”¶ç›Šï¼ˆå‡è®¾ç­‰æƒé‡æŒæœ‰æ‰€æœ‰æ ‡çš„ï¼‰
        benchmark_return = returns.iloc[i].mean()
        benchmark_net_value.append(benchmark_net_value[-1] * (1 + benchmark_return))

    # å°è£…ç»“æœ
    result_df = pd.DataFrame({
        'ç­–ç•¥å‡€å€¼': strategy_net_value,
        'ç­‰æƒåŸºå‡†': benchmark_net_value
    }, index=df.index[lookback-1:])
    return result_df

# ===========================
# 4. æ‰§è¡Œä¸å±•ç¤º
# ===========================
results = run_backtest(data, LOOKBACK, REBALANCE_FREQ)

# è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
total_ret = (results['ç­–ç•¥å‡€å€¼'].iloc[-1] - 1) * 100
annual_ret = ((results['ç­–ç•¥å‡€å€¼'].iloc[-1])**(250/len(results)) - 1) * 100
# è®¡ç®—æœ€å¤§å›æ’¤
rolling_max = results['ç­–ç•¥å‡€å€¼'].cummax()
drawdown = (results['ç­–ç•¥å‡€å€¼'] - rolling_max) / rolling_max
max_dd = drawdown.min() * 100

print(f"\n--- å›æµ‹æŠ¥å‘Š ---")
print(f"å›æµ‹æœŸé—´: {data.index[0].date()} è‡³ {data.index[-1].date()}")
print(f"ç´¯è®¡æ”¶ç›Š: {total_ret:.2f}%")
print(f"å¹´åŒ–æ”¶ç›Š: {annual_ret:.2f}%")
print(f"æœ€å¤§å›æ’¤: {max_dd:.2f}%")

# ç»˜å›¾
plt.figure(figsize=(12, 6))
plt.plot(results['ç­–ç•¥å‡€å€¼'], label='åŠ¨é‡è½®åŠ¨ç­–ç•¥', color='red', linewidth=2)
plt.plot(results['ç­‰æƒåŸºå‡†'], label='ç­‰æƒæŒæœ‰åŸºå‡†', color='gray', linestyle='--')
plt.title(f'åŠ¨é‡è½®åŠ¨ç­–ç•¥å›æµ‹ (å›çœ‹:{LOOKBACK}å¤©, è°ƒä»“:{REBALANCE_FREQ}å¤©)')
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
```

å›æµ‹ç»“æœ


![9d05ff365e3fa65e450e32c79c096e2a](https://cdn.jsdelivr.net/gh/thinkmoon/pic@master/images/9d05ff365e3fa65e450e32c79c096e2a.png)

![51fd0ca4ff62bd2a2660a4e2b70b02fe](https://cdn.jsdelivr.net/gh/thinkmoon/pic@master/images/51fd0ca4ff62bd2a2660a4e2b70b02fe.png)

## 6. æ€»ç»“ä¸å±•æœ›

é€šè¿‡è¿™ä¸ª Python é‡åŒ–çœ‹æ¿ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ•°æ®é©±åŠ¨çš„å†³ç­–ï¼Œä¸€çœ¼çœ‹æ¸…å½“å‰å¸‚åœºçš„â€œé¢†å¤´ç¾Šâ€æ˜¯è°ï¼Œæœ‰æ•ˆè§„é¿ç”±äºä¸»è§‚åå¥½å¯¼è‡´çš„â€œæ­»å®ˆäºæŸæ ‡çš„â€ã€‚


> **å…è´£å£°æ˜**ï¼šæœ¬æ–‡å†…å®¹ä»…ä¾›é‡åŒ–æŠ€æœ¯äº¤æµå’Œç¼–ç¨‹å­¦ä¹ ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚é‡‘èå¸‚åœºæœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚
